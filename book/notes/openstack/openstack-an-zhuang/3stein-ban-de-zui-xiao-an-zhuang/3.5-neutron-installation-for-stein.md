---
description: 如何在控制器节点，计算节点上和网络节点上安装和配置代号为neutron的OpenStack networking service
---

# 3.5、neutron installation for Stein

## 前提条件

参考:[https://docs.openstack.org/neutron/stein/install/controller-install-ubuntu.html](https://docs.openstack.org/neutron/stein/install/controller-install-ubuntu.html)

创建库，授权库，创建openstack用户，规则等，创建openstack endpoint等

## 一、Install and configure controller node

### 1. 安装组件

```text
apt install neutron-server neutron-metadata-agent
```

### 2. Configure the server component

### **3. Configure the metadata agent**

### **4. Configure the Compute service to use the Networking service**

### **5.** Configure the Modular Layer 2 \(ML2\) plug-in

The ML2 plug-in uses the Linux bridge mechanism to build layer-2 \(bridging and switching\) virtual networking infrastructure for instances.

{% hint style="info" %}
After you configure the ML2 plug-in, removing values in the `type_drivers` option can lead to database inconsistency.
{% endhint %}

## 二、Install and configure compute node

### 1. 安装组件

```text
apt install neutron-linuxbridge-agent
```

{% hint style="info" %}
The Linux bridge agent only supports VXLAN overlay networks.
{% endhint %}

### 2. Configure the common component

Edit the `/etc/neutron/neutron.conf` file and complete the following actions:

### 3. **Networking Option 2: Self-service networks**

#### Configure the Linux bridge agent

Linux 桥接代理为实例构建第 2 层（桥接和交换）虚拟网络基础架构并处理安全组。

* 编辑`/etc/neutron/plugins/ml2/linuxbridge_agent.ini`文件并完成以下操作：
  * 在该`[linux_bridge]`部分中，将提供者虚拟网络映射到提供者物理网络接口：

    ```text
    [linux_bridge]
    physical_interface_mappings = provider:PROVIDER_INTERFACE_NAME
    ```

    替换`PROVIDER_INTERFACE_NAME`为底层提供者物理网络接口的名称。For example, _eth1_ or _ens224_

  * 在该`[vxlan]`部分中，启用VXLAN overlay networks，配置处理overlay networks的物理网络接口的IP地址，并启用第2层填充：

    ```text
    [vxlan]
    enable_vxlan = true
    local_ip = OVERLAY_INTERFACE_IP_ADDRESS
    l2_population = true
    ```

    替换`OVERLAY_INTERFACE_IP_ADDRESS`为处理overlay networks的底层物理网络接口的 IP 地址。示例架构使用管理接口将流量通过隧道传输到其他节点。因此，替换`OVERLAY_INTERFACE_IP_ADDRESS`为计算节点的管理IP地址。

  * 在该`[securitygroup]`部分中，启用安全组并配置 Linux 网桥 iptables 防火墙驱动程序：

    ```text
    [securitygroup]
    # ...
    enable_security_group = true
    firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver
    ```

  * 通过验证以下所有`sysctl`值都设置为，确保您的 Linux 操作系统内核支持网桥过滤器`1`：

    ```text
    net.bridge.bridge-nf-call-iptables
    net.bridge.bridge-nf-call-ip6tables
    ```

    要启用网络桥接支持，通常`br_netfilter`需要加载内核模块

## 三、Install and configure network node

安装组件：neutron-plugin-ml2,neutron-linuxbridge-agent,neutron-l3-agent,neutron-dhcp-agent,neutron-metadata-agent

